#! /bin/bash

if ! command -v python3 >/dev/null; then
  echo "You need to have python3 installed.";
  exit 1
fi

# configuration
HOST=127.0.0.1
PORT=8000

# kill webserver process when script has ended
_term() {
  echo "Shutting down servers..."
  kill -TERM "$SERVER_PID" 2>/dev/null
  # docker stop ocrmypdf-auto
}
trap _term TERM INT

# start webserver
./bin/server.py $PORT &
SERVER_PID=$!

# start OCR if not already running
[ ! "$(docker ps -a | grep 'ocrmypdf-auto')" ] && ./bin/ocr

echo "To access EXcite tools, open http://$HOST:$PORT/index.html"
wait "$SERVER_PID"
